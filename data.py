import json
import os
from datetime import datetime


# =========================å…±é€šã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹è¨­å®š=========================
current_dir = os.path.dirname(__file__)
json_path = os.path.join(current_dir, "data.json")


# =========================ãƒ‡ãƒ¼ã‚¿ã‚’ä¿ç®¡ã™ã‚‹å¤‰æ•°=========================
data_stock = {}


# =========================ãƒ‡ãƒ¼ã‚¿ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜=========================
def save_json():
    # print("ğŸ’¾ ä¿å­˜ã•ã‚Œã‚‹å†…å®¹ï¼š", data_stock)
    with open(json_path, "w", encoding="utf-8") as f:               # â†å…±é€šã®ãƒ‘ã‚¹ä½¿ç”¨ã€€æ›¸ãè¾¼ã¿ãƒ¢ãƒ¼ãƒ‰ã§å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãï¼ˆãã®ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ›¸è¾¼ã¿ãªã©ã¯fã‚’ç”¨ã„ã‚‹ï¼Ÿï¼‰
        json.dump(data_stock, f, ensure_ascii=False, indent=2)      #è¾æ›¸ã®ä¸­èº«ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆfï¼‰ã«JSONå½¢å¼ã§æ›¸ãè¾¼ã‚€


# =========================JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§å¾©å…ƒ=========================
def load_json():

    global data_stock                                           #é–¢æ•°å¤–ã®å¤‰æ•°data_stockã‚’ä½¿ã†

    if not os.path.exists(json_path):                           #json_pathãŒç„¡ã‹ã£ãŸå ´åˆã¯
        print("ğŸš¨ data.json ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼")                 #è­¦å‘Šã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«è¡¨ç¤º
        data_stock = {}                                         #data_stockï¼ˆè¾æ›¸ï¼‰ã‚’ç©ºã«ã™ã‚‹
        return

    try:
        with open(json_path, "r", encoding="utf-8") as f:       #json_pathã¨ã„ã†ãƒ‘ã‚¹ã®å…ˆã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ãƒ¢ãƒ¼ãƒ‰ã§é–‹ãï¼ˆãã®ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®èª­ã¿è¾¼ã¿ãªã©ã¯fã‚’ç”¨ã„ã‚‹ï¼Ÿï¼‰
            loaded_data = json.load(f)                          #ãã®ä¸­èº«ã‚’ JSON ã¨ã—ã¦èª­ã¿è¾¼ã‚“ã§ã€loaded_data ã«å…¥ã‚Œã‚‹
            data_stock.clear()                                  # â†ã“ã“ã§å…ƒã®è¾æ›¸ã‚’ã‚¯ãƒªã‚¢
            data_stock.update(loaded_data)                      # â†data_stock(è¾æ›¸)ã®ä¸­èº«ã‚’ä¸­èº«ã‚’loaded_dataã«æ›´æ–°ï¼
            print("ğŸ“¦ èª­ã¿è¾¼ã¿æˆåŠŸï¼ä¸­èº«ï¼š", data_stock)
    except Exception as e:                                      #ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚‰ã€å†…å®¹ã‚’eã«å…¥ã‚Œã‚‹
        print("âŒ èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ï¼š", e)                          #ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’è¡¨ç¤º
        data_stock = {}                                         #data_stockã‚’ç©ºã«ã™ã‚‹


# =========================IDã®ç”Ÿæˆ=========================
def get_next_id():
    if data_stock:                                              #è¾æ›¸ã«ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆ
        return str(max(int(k) for k in data_stock.keys()) + 1)  #ä»Šã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã®ä¸­ã§æœ€å¤§ã®IDã‚’æ¢ã—ã¦ã€ãã‚Œã«1ã‚’è¶³ã—ã¦ã€æ–°ã—ã„IDã¨ã—ã¦è¿”ã™ï¼ˆè¾æ›¸ã§ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€æ•´æ•°å‹ã«ã—ã¦å–ã‚Šå‡ºã—ã¦1ã‚’è¶³ã—ã¦ã€å†åº¦æ–‡å­—å‹ã«ã‚‚ã©ã—ã¦ã„ã‚‹ï¼‰
    else:                                                       #è¾æ›¸ã«ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆ
        return "1"                                              #æœ€åˆã®ãƒ‡ãƒ¼ã‚¿ã¨ã„ã†ã“ã¨ã§1ã‚’è¿”ã™


# =========================ãƒ‡ãƒ¼ã‚¿ã®è¾æ›¸ã‹ã‚‰idã‚’æ¢ã™ï¼ˆç„¡ã‘ã‚Œã°Noneï¼‰=========================
def     get_data_by_id(id):
    return data_stock.get(id)   #å¼•æ•°ã§æ¸¡ã•ã‚ŒãŸidã«å¯¾å¿œã™ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆè¾æ›¸ã®ä¸­èº«ï¼‰ã‚’è¿”ã™ã€€ãªã„å ´åˆã¯Noneã‚’è¿”ã™ï¼ˆ.get(id, ã‚ã‚Šã¾ã›ã‚“)ï¼‰ã¨ã—ã¦ã„ãŸã‚‰ã€Noneã§ã¯ãªãã€Œã‚ã‚Šã¾ã›ã‚“ã€ã‚’è¿”ã™
