{% extends "base.html" %}

{% block title %}学習記録フォーム{% endblock %}

{% block content %}
<!-- TOPページであり、フォーム画面 -->
<form method="POST">
    <label for="id_text_name">あなたの名前：</label><br>
    <input type="text" name="name" id="id_text_name" value="{{ name }}"><br><br>

    <label for="id_select_category">カテゴリー：</label>
    <select name="category" id="id_select_category">
        <option value="学習" {% if category=="学習" %}selected{% endif %}>学習</option>
        <option value="雑談" {% if category=="雑談" %}selected{% endif %}>雑談</option>
        <option value="日記" {% if category=="日記" %}selected{% endif %}>日記</option>
    </select><br>

    <label for="id_text_message">メッセージ：</label><br>
    <textarea name="message" id="id_text_message">{{ message }}</textarea><br><br>

    <button type="submit">記録する</button>
</form>


<h3>📚これまでの記録</h3>

<p><small>※このページを開いたのは：{{ timestamp }}</small></p>

<!-- カテゴリー -->
<form method="GET" action="/">
    <button name="filter" value="all">すべて</button>
    <button name="filter" value="学習">学習</button>
    <button name="filter" value="雑談">雑談</button>
    <button name="filter" value="日記">日記</button>
</form><br><br>


<!-- キーワード検索 -->
<form method="GET" action="/">
    <label for="search">🔍 キーワード検索：</label>
    <input type="text" name="keyword" id="search" value="{{ keyword }}">
    <button type="submit">検索</button>
</form>
<!-- app.pyからの返りにエラーがあった場合 -->
{% if error %}
<p style="color: red;">⚠️ {{ error }}</p>
{% endif %}


<!-- 並び順 -->
<form method="GET" action="/">
    <input type="hidden" name="filter" value="{{ filter }}">
    <input type="hidden" name="keyword" value="{{ keyword }}">
    <button name="sort" value="time">🕒 新しい順</button>
    <button name="sort" value="name">🔤 名前順</button>
</form>


<!-- app.pyからの返ってきたデータを表示させる -->
{% if data %}
<ul>
    {% for id, item in data.items() %}
    <li><strong>{{ id }}. {{ item.name }}</strong>：{{item.category}}.{{ item.message }}</li>
    <small>（送信時刻：{{ item.time }}）</small>
    <form method="POST" action="/delete/{{ id }}" style="display:inline;">
        <button type="submit">削除</button>
    </form>
    <form method="GET" action="/edit/{{ id }}" style="display:inline;">
        <button type="submit">編集</button>
    </form>
    {% endfor %}
</ul>
{% else %}
<p>まだ記録はありません！</p>
{% endif %}

{% endblock %}